
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>AR - WEB</title>
	<link rel="stylesheet" href="">
	

	<script src="js/jquery-1.12.3.min.js"></script>
	<script src="js/jquery-migrate-1.3.0.min.js"></script>
	<!-- include three.js -->
	<script src="js/three.min.js"></script>
	<!-- include js-aruco -->
	<script src='js/vendor/js-aruco/svd.js'></script>
	<script src='js/vendor/js-aruco/posit1-patched.js'></script>
	<script src='js/vendor/js-aruco/cv.js'></script>
	<script src='js/vendor/js-aruco/aruco.js'></script>
	<!-- include some extensions -->
	<script src='js/threex.webcamgrabbing.js'></script>
	<script src='js/threex.imagegrabbing.js'></script>
	<script src='js/threex.videograbbing.js'></script>
	<script src='js/threex.jsarucomarker.js'></script>

	<script src='js/threex.videotexture.js'></script>


	<style>
		body {
			background-color: black;
		}
		.playBtn {
		    position: absolute;
		    width: 100%;
		    height: 100%;
		    background: rgba(0,0,0,0.5);
		}
		.playBtn img {
		    position: absolute;
		    width: 150px;
		    height: 150px;
		    top: 50%;
		    left: 50%;
		    margin: -75px 0 0 -75px;
		}
	</style>
</head>
<body style='margin: 0px; overflow: hidden; text-align:center;'>
	<div id="container" data-video-src="video/reel_LM_2.mp4">
		<div class="playBtn">
			<img src="images/playBtn.png" class="playTrigger" alt="">
		</div>
	</div>
<script>
	$(".playTrigger").click( function(){
		$(".playBtn").fadeOut();
		vid.play();
	});
</script>
<script>
	//////////////////////////////////////////////////////////////////////////////////
	//		Init
	//////////////////////////////////////////////////////////////////////////////////

	// init renderer
	var renderer	= new THREE.WebGLRenderer({
		antialias	: true,
		alpha		: true,
	});
	renderer.autoClear = true;
	renderer.setSize( window.innerWidth, window.innerHeight );
	document.body.appendChild( renderer.domElement );

	// array of functions for the rendering loop
	var onRenderFcts = [];

	// init scene and camera
	var scene = new THREE.Scene()
	var camera	= new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.01, 1000);
	camera.position.z = 2;

	//////////////////////////////////////////////////////////////////////////////////
	//		add an object in the scene
	//////////////////////////////////////////////////////////////////////////////////
	var vid;
	// add some debug display
	;(function(){
		var geometry = new THREE.PlaneGeometry(1,1,10,10)
		var material = new THREE.MeshBasicMaterial( {
			wireframe : true
		})
		var mesh = new THREE.Mesh(geometry, material);
		// scene.add( mesh );

		var mesh = new THREE.AxisHelper
		// scene.add( mesh );
	})()

	;(function(){

		if( $("#container").attr('data-video-src') ) {

			var attrSrc = $("#container").attr('data-video-src');

			var videoTexture= new THREEx.VideoTexture( attrSrc );
			onRenderFcts.push(function(delta, now){
				videoTexture.update(delta, now)
			})

			vid = videoTexture.video;

			vid.pause();

			var geometry	= new THREE.PlaneGeometry(1.5,1,1);
			var material	= new THREE.MeshBasicMaterial({
				map	: videoTexture.texture
			});
			var mesh	= new THREE.Mesh( geometry, material );
			scene.add( mesh );

		} else {
			console.log("// VIDEO = FALSE //");
		}

	})()





	//////////////////////////////////////////////////////////////////////////////////
	//		render the whole thing on the page
	//////////////////////////////////////////////////////////////////////////////////

	// handle window resize
	window.addEventListener('resize', function(){
		renderer.setSize( window.innerWidth, window.innerHeight )
		camera.aspect	= window.innerWidth / window.innerHeight
		camera.updateProjectionMatrix()
	}, false)

	// set the scene as visible
	scene.visible	= false

	// render the scene
	onRenderFcts.push(function(){
		renderer.render( scene, camera );
	})

	// run the rendering loop
	var previousTime = performance.now()
	requestAnimationFrame(function animate(now){

		requestAnimationFrame( animate );
		update();

		onRenderFcts.forEach(function(onRenderFct){
			onRenderFct(now, now - previousTime)
		})

		previousTime	= now
	})

	function update() {

		/*if ( vid.readyState === vid.HAVE_ENOUGH_DATA) {
	        if(typeof(skyBoxtexture) !== "undefined" ) {
	            var ct = new Date().getTime();
	            if(ct - time >= 30) {
	                skyBoxtexture.needsUpdate = true;
	                time = ct;
	            }
	        }
	    } */

		
		requestAnimationFrame(update);
		camera.updateProjectionMatrix();

	}

	//////////////////////////////////////////////////////////////////////////////////
	//		Do the Augmented Reality Upgrade
	//////////////////////////////////////////////////////////////////////////////////


	// init the marker recognition
	var jsArucoMarker	= new THREEx.JsArucoMarker()

	// init the image source grabbing
	if( false ){
		var videoGrabbing = new THREEx.VideoGrabbing()
		jsArucoMarker.videoScaleDown = 10
	}else if( true ){
		var videoGrabbing = new THREEx.WebcamGrabbing()
		jsArucoMarker.videoScaleDown = 2
	}else if( true ){
		var videoGrabbing = new THREEx.ImageGrabbing()
		jsArucoMarker.videoScaleDown = 10
	}else console.assert(false)

	// attach the videoGrabbing.domElement to the body
        document.body.appendChild(videoGrabbing.domElement)

	// process the image source with the marker recognition
	onRenderFcts.push(function(){
		var domElement	= videoGrabbing.domElement
		var markers	= jsArucoMarker.detectMarkers(domElement)
		var object3d	= scene

		object3d.visible = false

		// see if this.markerId has been found
		markers.forEach(function(marker){
			if( marker.id !== 265 )	return

			jsArucoMarker.markerToObject3D(marker, object3d)

			object3d.visible = true

			//vid.play();

		})
	})
</script></body>
</html>